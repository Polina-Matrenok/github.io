# -*- coding: utf-8 -*-
"""dataset_preparation.ipynb

Automatically generated by Colaboratory.

Original file is located at
    https://colab.research.google.com/drive/18tf68ziftB-OL17gCFbfAxhT7KTkbS5m
"""

!wget https://github.com/yutkin/Lenta.Ru-News-Dataset/releases/download/v1.1/lenta-ru-news.csv.bz2

!bzip2 -d /content/lenta-ru-news.csv.bz2

import pandas as pd
from tqdm.notebook import tqdm

texts = pd.read_csv('/content/lenta-ru-news.csv').text

!pip install razdel

from razdel import sentenize

N_WORDS_AHEAD = 3
punctuation_marks = '.,!?-:;'

texts[:5][0]

dataset = pd.DataFrame({'X': [], 'y': []})
for text in tqdm(texts[:]):
    sentences = list(sentenize(text))
    for sentence_1, sentence_2 in zip(sentences[:-1], sentences[1:]):
        words = (sentence_1.text + ' ' + sentence_2.text).split()
        for i in range(1, len(sentence_1.text.split())+1):
            try:
                sample = words[:i]
                answer = sample[-1][-1] if sample[-1][-1] in punctuation_marks else ''
                if answer != '':
                    sample[-1] = sample[-1][:-1]
                for k in range(N_WORDS_AHEAD):
                    if words[i+k][-1] in punctuation_marks:
                        sample += [words[i+k][:-1]]
                    else:
                        sample += [words[i+k]]
                # print('sample:', sample, 'answer:', answer)

                dataset = dataset.append(pd.DataFrame({'X': [' '.join(sample)], 'y': [answer]}), ignore_index=True)
            except:
                pass
        # print('!')

dataset.head()

index = '1'
dataset.save_csv('dataset_' + index + '.csv')